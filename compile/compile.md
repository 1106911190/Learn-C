# C 语言编译流程

虽然一直都用 gcc 直接编译代码生成可执行文件，但是一直都不清楚编译到底有哪几步。

以 hello.c 为例

```
#include "stdio.h"

int main(int argc, char const *argv[])
{
	printf("hello world\n");
	return 0;
}

```

直接从 C 语言文件到 可执行文件。

```
gcc hello.c -o hello
```

实际上的编译流程有四步
1. 预处理
2. 编译
3. 汇编
4. 链接

## 预处理

将头文件包含进来，比如上文中的 `stdio.h`， 会在本机上找到相关的库，将即包含进来。

```
gcc -E hello.c -o hello.i
```

可以打开 `hello.i` 查看引用进来的头文件，指定了其在本地的位置。

## 编译

将 C 语言代码编译为 汇编代码，这个阶段需要编译器

```
gcc -S hello.i -o hello.s
```

同样可以打开 `hello.s` 查看汇编代码，全是 `push`,`mov`,`pop` 之类的。


## 汇编

将汇编代码转为二进制代码，这个阶段需要汇编器。

```
gcc -c hello.s -o hello.o
```

这个时候打开 `hello.o` ，已经全是0和1之类的代码，无法识别，完全看不懂是什么东西。

## 链接

```
gcc hello.o -o hello.bin
```

将汇编代码链接动态库和静态库，这时就是一个完整的可执行文件了。

可以对比一下使用 gcc 分步执行生成的可执行文件和直接生成的可执行文件，哈希校验都是一致的。

也可以对比一下 汇编之后的二进制代码和最终的可执行文件，可以看到多了一些链接库的东西。


